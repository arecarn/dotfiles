#!/bin/sh

if [ $# -eq 0 ]; then
    echo "usage: trash <files...>" >&2
    exit 2;
fi

trash_directory="$HOME/.trash"
if [ ! -d "${trash_directory}" ]; then
    mkdir "${trash_directory}"
fi

for file in "$@"; do
    # supress: "warning: dest_file appears unused. Verify it or export it."
    # shellcheck disable=SC2034
    dest_file=$(basename "${file}")
    suffix=''
    i=0

    # suppress "note: Expressions don't expand in single quotes, use double
    #           quotes"
    # shellcheck disable=SC2016
    trash_file_path='${trash_directory}/${dest_file}${suffix}'
    # If that file already exists, change the name
    while [ -e "$(eval echo "${trash_file_path}")" ]; do
        # suppress: warning: suffix appears unused. Verify it or export it.
        # shellcheck disable=SC2034
        suffix="-${i}";
        i=$((i + 1))
    done

    eval mv -vi "$file" "$trash_file_path"
done
